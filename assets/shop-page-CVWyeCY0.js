import{j as e,m as x,r as j,w as S,F as A,n as p,x as P,D as I,J as O,a as w,T as d,u as B,S as k,I as F,o as M,P as V,Q as H,U as y,f as N,N as _,V as L,W as G,q as Y}from"./index-SoLVvKIf.js";import{P as J}from"./page-header-CaiBjco0.js";import{g as $,S as C}from"./switch-DJqrok9e.js";import{u as W,S as T,e as q,h as K,i as Q,j as X,k as f,g as b,m as Z,f as m,E as U,s as v,n as D,B as ee,P as se,a as te,b as ne,V as re,I as oe,T as ie,c as ae,d as R}from"./tracks-CTTweL8X.js";import{S as z}from"./tracks-hkNVkI4D.js";import{V as le,C as ce}from"./content-name-badge-gK6DEfkx.js";import{S as de}from"./cars-AL0pgiR5.js";import{F as g}from"./index-CYCSZe20.js";function ue(){return e.jsx(x,{padding:{base:"unset",md:4},justifyContent:"space-between",alignItems:"start",children:e.jsx(J,{title:"Shop Guide",description:`See the tracks most used by your favorite series. Checkout your
          wishlist items at iracing.com`})})}function he(){const{myTracks:u,wishTracks:h,favoriteSeries:o}=W(),l=j.useMemo(()=>o.reduce((s,n)=>{const r=T[n.toString()];return r.weeks.forEach(a=>{const t=q[a.track.id.toString()];if(t.free)return s;const c="group"in t?t.group:t.id;s[c]=s[c]??{id:c,name:t.name,sku:t.sku,weeks:{},used:0};const E=$(a.date);s[c].weeks[r.id]=s[c].weeks[r.id]??[],s[c].weeks[r.id].push(E),s[c].used++},null),s},{}),[o]),i=j.useMemo(()=>Object.values(l).sort((s,n)=>n.used+Object.keys(n.weeks).length-(s.used+Object.keys(s.weeks).length)).concat(h.map(s=>{const n=z.find(r=>r.sku===s);return n&&!(n.id in l)?{id:n.id,name:n.name,sku:n.sku,weeks:{},used:0}:null}).filter(s=>!!s)),[l]);return e.jsx(S,{flex:1,borderRadius:"md",overflowY:"auto",maxH:"100%",w:"100%",h:"100%",alignItems:"start",children:e.jsx(K,{borderRadius:"md",width:"100%",children:e.jsxs(Q,{striped:!0,children:[e.jsx(X,{children:e.jsxs(f,{bgColor:"bg.muted",children:[e.jsx(b,{minWidth:"40px",textAlign:"center",children:e.jsx(le,{children:"Owned content"})}),e.jsx(b,{width:"100%",children:"Name"}),e.jsx(b,{textAlign:"center",children:"Used"})]})}),e.jsx(Z,{children:e.jsx(A,{fallback:e.jsx(f,{bgColor:"transparent",children:e.jsx(m,{colSpan:8,minWidth:"100%",children:e.jsx(U,{icon:e.jsx(p,{icon:P}),title:o.length>0?"No paid tracks missing":"No series selected",description:o.length>0?"You already own all tracks of your favorite series":"You didn't choose any favorite series"})})}),each:i,children:s=>{const n=u.includes(s.sku),r=h.includes(s.sku);return e.jsxs(f,{bgColor:"transparent",children:[e.jsx(m,{minWidth:"40px",textAlign:"center",p:0,borderBottom:0,px:"4px",children:e.jsx(I,{size:"sm",mt:"2px",colorPalette:r?"blue":void 0,checked:n||r,controlProps:{borderColor:!r&&!n?"gray.400":void 0},icon:r?e.jsx(p,{size:"xs",icon:O}):void 0,onClick:a=>a.stopPropagation(),onCheckedChange:()=>{n?(v(s.sku,!1),D(s.sku,!0)):r?D(s.sku,!1):v(s.sku,!0)}})}),e.jsx(m,{display:"flex",p:1,borderBottom:0,px:"4px",children:e.jsx(ce,{name:s.name})}),e.jsx(m,{minWidth:"90px",textAlign:"center",p:1,borderBottom:0,px:"4px",children:e.jsx(w,{lazyMount:!0,unmountOnExit:!0,content:Object.keys(s.weeks).map(a=>e.jsxs(x,{justifyContent:"space-between",children:[e.jsx(d,{textAlign:"left",truncate:!0,children:T[a.toString()].name}),e.jsx(d,{textAlign:"right",children:s.weeks[parseInt(a)].join(", ")})]},a)),showArrow:!0,positioning:{placement:"top"},openDelay:200,closeDelay:100,children:e.jsxs(ee,{size:"xs",variant:"solid",_light:{bg:"gray.600"},children:[s.used,"x"]})})})]},s.id)}})})]})})})}function xe(){const{wishCars:u,wishTracks:h}=W(),{shopLoyaltyDiscount:o,shopVolumeDiscount:l}=B(),i=j.useMemo(()=>z.filter(t=>h.includes(t.sku)).map(t=>({...t,isCar:!1})).concat(de.filter(t=>u.includes(t.sku)).map(t=>({...t,isCar:!0}))),[h,u]),s=j.useMemo(()=>i.reduce((t,c)=>t+c.price,0),[i]),n=o?20:l?i.length<3?0:i.length<6?10:i.length<20?15:20:0,r=s*n/100,a=s-r;return e.jsxs(k,{flex:1,borderRadius:"md",w:"100%",h:"100%",maxH:"100%",bgColor:"bg.muted",p:4,children:[e.jsxs(x,{justifyContent:"space-between",children:[e.jsx(d,{textStyle:"3xl",children:"Wishlist"}),e.jsxs(se,{positioning:{placement:"left-start"},children:[e.jsx(te,{asChild:!0,children:e.jsx(F,{"aria-label":"Settings",variant:"outline",size:"lg",bgColor:{base:"bg.muted",_hover:"bg"},borderRadius:"md",children:e.jsx(p,{icon:M})})}),e.jsx(ne,{children:e.jsxs(re,{alignItems:"start",p:2,children:[e.jsx(w,{lazyMount:!0,unmountOnExit:!0,content:"Apply iRacing discounts for bundle purchases",showArrow:!0,positioning:{placement:"top"},openDelay:200,closeDelay:100,ids:{trigger:"volumeDiscount"},children:e.jsx(C,{ids:{root:"volumeDiscount"},checked:l,onCheckedChange:({checked:t})=>V(t),children:"Volume discount"})}),e.jsx(w,{lazyMount:!0,unmountOnExit:!0,content:"Apply iRacing loyalty discount",showArrow:!0,positioning:{placement:"top"},openDelay:200,closeDelay:100,ids:{trigger:"loyaltyDiscount"},children:e.jsx(C,{ids:{root:"loyaltyDiscount"},checked:o,onCheckedChange:({checked:t})=>H(t),children:"Loyalty discount"})})]})})]})]}),e.jsxs(k,{overflowY:"auto",flex:1,children:[e.jsx(y,{}),e.jsx(A,{fallback:e.jsx(U,{icon:e.jsx(p,{icon:P}),title:"Empty wishlist",description:"Add some cars or tracks to your wishlist"}),each:i,children:t=>e.jsxs(j.Fragment,{children:[e.jsxs(x,{children:[e.jsx(p,{icon:t.isCar?N:_,size:"sm"}),e.jsx(S,{flex:1,children:t.name}),e.jsx(g,{style:"currency",currency:"USD",value:t.price})]}),e.jsx(y,{})]},t.id)})]}),e.jsxs(x,{mt:2,justifyContent:"space-between",fontWeight:"bold",alignItems:"end",children:[e.jsx(d,{textStyle:"4xl",children:"Total"}),e.jsxs(k,{alignItems:"end",gap:0,children:[(l||o)&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{color:"gray",children:[e.jsx(g,{style:"currency",currency:"USD",value:s}),e.jsx(d,{children:"-"}),e.jsx(g,{style:"currency",currency:"USD",value:r})]}),e.jsxs(d,{color:"gray",textAlign:"center",textStyle:"xs",fontWeight:"normal",children:[n,"% discount (",o?"loyalty":`${i.length} items`,")"]}),e.jsx(y,{mt:2})]}),e.jsx(d,{fontSize:"2xl",children:e.jsx(g,{style:"currency",currency:"USD",value:a})})]})]}),e.jsxs(L,{as:"a",disabled:i.length<1,size:"lg",href:i.length>0?`${oe.store}?skus=${i.map(t=>t.sku)}`:void 0,target:"_blank",rel:"noreferrer",colorPalette:"blue",children:["Checkout on iRacing.com store",e.jsx(p,{icon:G})]})]})}function we(){const[u,h]=j.useState("TracksUsed"),{size:o}=Y();return e.jsxs(S,{direction:"column",height:"100%",width:"100%",gap:"8px",children:[e.jsx(ue,{}),e.jsx(k,{hideFrom:"md",children:e.jsx(ie,{size:"sm",value:u,onValueChange:l=>h(l.value),variant:"enclosed",width:"100%",flex:1,children:e.jsxs(ae,{flex:1,width:"100%",children:[e.jsx(R,{value:"TracksUsed",width:"100%",children:e.jsx(d,{textWrap:"nowrap",children:"Tracks Used"})}),e.jsx(R,{value:"WishlistPanel",width:"100%",children:e.jsx(d,{textWrap:"nowrap",children:"Wishlist"})})]})})}),e.jsxs(x,{flex:1,alignItems:"start",overflow:"hidden",gap:2,children:[(u==="TracksUsed"||o.md)&&e.jsx(he,{}),(u==="WishlistPanel"||o.md)&&e.jsx(xe,{})]})]})}export{we as default};
