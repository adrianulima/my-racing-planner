import{j as e,B as W,T as i,q as T,m as x,t as P,b,l as u,C as z,r as h,F as R,u as A,I as B,n as F,M,N as V,O as H,P as N,S,Q as w,f as _,J as Y,U as q}from"./index-bg1tIQXq.js";import{u as G,P as J,a as $}from"./page-header-BC_dFHe6.js";import{T as K,c as L,d as v,u as k,i as C,j as g,E as U,k as Q,S as E,e as X,q as I,m as Z,h as ee,g as f,n as se,P as te,a as ne,b as re,V as oe,I as ae}from"./content-checkbox-fU7pSMSk.js";import{g as ie,S as D}from"./useSeason-mGnMBBjB.js";import{C as le,V as ce}from"./content-name-badge-iyQbZH53.js";import{S as de}from"./cars-B48Xdc-4.js";import{F as m}from"./index-DNaVLbmh.js";var y=(s=>(s.TracksUsed="TracksUsed",s.WishlistPanel="WishlistPanel",s))(y||{});function ue({tab:s,setTab:r,...o}){return e.jsx(W,{...o,children:e.jsx(K,{size:"sm",value:s,onValueChange:t=>r(t.value),variant:"enclosed",width:"100%",flex:1,children:e.jsxs(L,{flex:1,width:"100%",children:[e.jsx(v,{value:"TracksUsed",width:"100%",children:e.jsx(i,{textWrap:"nowrap",children:"Tracks Used"})}),e.jsx(v,{value:"WishlistPanel",width:"100%",children:e.jsx(i,{textWrap:"nowrap",children:"Wishlist"})})]})})})}function he(){const{favoriteSeries:s}=k();return e.jsx(C,{bgColor:"transparent",children:e.jsx(g,{colSpan:8,minWidth:"100%",children:e.jsx(T,{justifyContent:"start",height:"100%",children:e.jsx(U,{icon:e.jsx(x,{icon:P}),title:s.length>0?"No paid tracks missing":"No series selected",description:s.length>0?"You already own all tracks of your favorite series":"You didn't choose any favorite series"})})})})}function xe({item:s}){const{myTracks:r,wishTracks:o}=k();return e.jsxs(C,{bgColor:"transparent",children:[e.jsx(g,{textAlign:"center",p:0,borderBottom:0,px:"4px",children:e.jsx(Q,{size:"sm",mt:"2px",content:"tracks",sku:s.sku,contentId:s.id,free:!1,owned:r.includes(s==null?void 0:s.sku),wish:o.includes(s==null?void 0:s.sku)})}),e.jsx(g,{width:"100%",display:"flex",p:1,borderBottom:0,px:"4px",children:e.jsx(le,{name:s.name})}),e.jsx(g,{textAlign:"center",p:1,borderBottom:0,px:"4px",children:e.jsx(b,{lazyMount:!0,unmountOnExit:!0,content:Object.keys(s.weeks).map(t=>e.jsxs(u,{justifyContent:"space-between",children:[e.jsx(i,{textAlign:"left",truncate:!0,children:E[t.toString()].name}),e.jsx(i,{textAlign:"right",children:s.weeks[parseInt(t)].join(", ")})]},t)),showArrow:!0,positioning:{placement:"top"},openDelay:200,closeDelay:100,children:e.jsxs(z,{size:"xs",variant:"solid",_light:{bg:"gray.600"},children:[s.used,"x"]})})})]})}function je(){const{wishTracks:s,favoriteSeries:r}=k(),{onScroll:o}=G(),t=h.useMemo(()=>r.reduce((n,a)=>{const l=E[a.toString()];return l.weeks.forEach(p=>{const d=X[p.track.id.toString()];if(d.free)return n;const c="group"in d?d.group:d.id;n[c]=n[c]??{id:c,name:d.name,sku:d.sku,weeks:{},used:0};const O=ie(p.date);n[c].weeks[l.id]=n[c].weeks[l.id]??[],n[c].weeks[l.id].push(O),n[c].used++},null),n},{}),[r]),j=h.useMemo(()=>Object.values(t).sort((n,a)=>a.used+Object.keys(a.weeks).length-(n.used+Object.keys(n.weeks).length)).concat(s.map(n=>{const a=I.find(l=>l.sku===n);return a&&!(a.id in t)?{id:a.id,name:a.name,sku:a.sku,weeks:{},used:0}:null}).filter(n=>!!n)),[t]);return e.jsx(T,{flex:1,borderRadius:"md",overflowY:"auto",maxH:"100%",h:"100%",alignItems:"start",onScroll:o,children:e.jsxs(Z,{striped:!0,stickyHeader:!0,height:"100%",borderRadius:"md",width:"100%",children:[e.jsx(ee,{children:e.jsxs(C,{bgColor:"bg.muted",children:[e.jsx(f,{textAlign:"center",children:e.jsx(ce,{children:"Owned content"})}),e.jsx(f,{width:"100%",children:"Name"}),e.jsx(f,{textAlign:"center",children:"Used"})]})}),e.jsx(se,{children:e.jsx(R,{fallback:e.jsx(he,{}),each:j,children:n=>e.jsx(xe,{item:n},n.id)})})]})})}function pe(){const{shopLoyaltyDiscount:s,shopVolumeDiscount:r}=A();return e.jsxs(te,{positioning:{placement:"left-start"},children:[e.jsx(ne,{asChild:!0,children:e.jsx(B,{"aria-label":"Settings",variant:"outline",size:"lg",bgColor:{base:"bg.muted",_hover:"bg"},borderRadius:"md",children:e.jsx(x,{icon:F})})}),e.jsx(re,{children:e.jsxs(oe,{alignItems:"start",p:2,children:[e.jsx(b,{lazyMount:!0,unmountOnExit:!0,content:"Apply iRacing discounts for bundle purchases",showArrow:!0,positioning:{placement:"top"},openDelay:200,closeDelay:100,ids:{trigger:"volumeDiscount"},children:e.jsx(D,{ids:{root:"volumeDiscount"},checked:r,onCheckedChange:({checked:o})=>M(o),children:"Volume discount"})}),e.jsx(b,{lazyMount:!0,unmountOnExit:!0,content:"Apply iRacing loyalty discount",showArrow:!0,positioning:{placement:"top"},openDelay:200,closeDelay:100,ids:{trigger:"loyaltyDiscount"},children:e.jsx(D,{ids:{root:"loyaltyDiscount"},checked:s,onCheckedChange:({checked:o})=>V(o),children:"Loyalty discount"})})]})})]})}function ge({wishList:s}){return e.jsxs(H,{as:"a",disabled:s.length<1,size:"lg",href:s.length>0?`${ae.store}?skus=${s.map(r=>r.sku)}`:void 0,target:"_blank",rel:"noreferrer",colorPalette:"blue",children:["Checkout on iRacing.com store",e.jsx(x,{icon:N})]})}function me({wishList:s}){const{shopLoyaltyDiscount:r,shopVolumeDiscount:o}=A(),t=h.useMemo(()=>s.reduce((l,p)=>l+p.price,0),[s]),j=r?20:o?s.length<3?0:s.length<6?10:s.length<20?15:20:0,n=t*j/100,a=t-n;return e.jsxs(u,{mt:2,justifyContent:"space-between",fontWeight:"bold",alignItems:"end",children:[e.jsx(i,{textStyle:"4xl",children:"Total"}),e.jsxs(S,{alignItems:"end",gap:0,children:[(o||r)&&e.jsxs(e.Fragment,{children:[e.jsxs(u,{color:"gray",children:[e.jsx(m,{style:"currency",currency:"USD",value:t}),e.jsx(i,{children:"-"}),e.jsx(m,{style:"currency",currency:"USD",value:n})]}),e.jsxs(i,{color:"gray",textAlign:"center",textStyle:"xs",fontWeight:"normal",children:[j,"% discount (",r?"loyalty":`${s.length} items`,")"]}),e.jsx(w,{mt:2})]}),e.jsx(i,{fontSize:"2xl",children:e.jsx(m,{style:"currency",currency:"USD",value:a})})]})]})}function ye(){const{wishCars:s,wishTracks:r}=k(),o=h.useMemo(()=>I.filter(t=>r.includes(t.sku)).map(t=>({...t,isCar:!1})).concat(de.filter(t=>s.includes(t.sku)).map(t=>({...t,isCar:!0}))),[r,s]);return e.jsxs(S,{flex:1,borderRadius:"md",w:"100%",h:"100%",maxH:"100%",bgColor:"bg.muted",p:4,children:[e.jsxs(u,{justifyContent:"space-between",children:[e.jsx(i,{textStyle:"3xl",children:"Wishlist"}),e.jsx(pe,{})]}),e.jsxs(S,{overflowY:"auto",flex:1,children:[e.jsx(w,{}),e.jsx(R,{fallback:e.jsx(U,{icon:e.jsx(x,{icon:P}),title:"Empty wishlist",description:"Add some cars or tracks to your wishlist"}),each:o,children:t=>e.jsxs(h.Fragment,{children:[e.jsxs(u,{children:[e.jsx(x,{icon:t.isCar?_:Y,size:"sm"}),e.jsx(T,{flex:1,children:t.name}),e.jsx(m,{style:"currency",currency:"USD",value:t.price})]}),e.jsx(w,{})]},t.id)})]}),e.jsx(me,{wishList:o}),e.jsx(ge,{wishList:o})]})}function ve(){const[s,r]=h.useState(y.TracksUsed),{size:o}=q();return e.jsxs(J,{children:[e.jsx($,{title:"Shop Guide",description:`See the tracks most used by your favorite series. Checkout your
          wishlist items at iracing.com`,children:e.jsx(ue,{hideFrom:"md",tab:s,setTab:r})}),e.jsxs(u,{flex:1,alignItems:"start",overflow:"hidden",gap:2,children:[(s===y.TracksUsed||o.md)&&e.jsx(je,{}),(s===y.WishlistPanel||o.md)&&e.jsx(ye,{})]})]})}export{ve as default};
